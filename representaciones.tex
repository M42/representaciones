%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Plantilla básica de Latex en Español.
%
% Autor: Andrés Herrera Poyatos (https://github.com/andreshp)
%
% Es una plantilla básica para redactar documentos. Utiliza el paquete fancyhdr para darle un
% estilo moderno pero serio.
%
% La plantilla se encuentra adaptada al español.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%-----------------------------------------------------------------------------------------------------
%	INCLUSIÓN DE PAQUETES BÁSICOS
%-----------------------------------------------------------------------------------------------------

\documentclass{article}

% Lenguaje
\usepackage[spanish,es-noquoting, es-tabla, es-lcroman]{babel}
\usepackage[utf8]{inputenc}
\selectlanguage{spanish}


% Matemáticas
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{tikz-cd}
\theoremstyle{plain}
\newtheorem{theorem}{Teorema}
\newtheorem{proposition}{Proposición}
\newtheorem{lemma}{Lema}
\newtheorem{corollary}{Corolario}
\theoremstyle{definition}
\newtheorem{definition}{Definición}
\theoremstyle{remark}
\newtheorem*{remark}{Nota}
\renewcommand*{\proofname}{Demostración}


% Fuente
\usepackage{courier}
\usepackage{microtype}


% ----
% Estilo de página
%----
% Paquetes para el diseño de página:
\usepackage{fancyhdr}               % Utilizado para hacer títulos propios.
\usepackage{lastpage}               % Referencia a la última página. Utilizado para el pie de página.
\usepackage{extramarks}             % Marcas extras. Utilizado en pie de página y cabecera.
\usepackage[parfill]{parskip}       % Crea una nueva línea entre párrafos.
\usepackage{geometry}               % Asigna la "geometría" de las páginas.

% Se elige el estilo fancy y márgenes de 3 centímetros.
\pagestyle{fancy}
\geometry{left=3cm,right=3cm,top=3cm,bottom=3cm,headheight=1cm,headsep=0.5cm} % Márgenes y cabecera.
% Se limpia la cabecera y el pie de página para poder rehacerlos luego.
\fancyhf{}

% Espacios en el documento:
\linespread{1.1}                        % Espacio entre líneas.
\setlength\parindent{0pt}               % Selecciona la indentación para cada inicio de párrafo.

% Cabecera del documento. Se ajusta la línea de la cabecera.
\renewcommand\headrule{
	\begin{minipage}{1\textwidth}
	    \hrule width \hsize
	\end{minipage}
}

% Texto de la cabecera:
\lhead{\docauthor}                          % Parte izquierda.
\chead{}                                    % Centro.
\rhead{\subject \ - \doctitle}              % Parte derecha.

% Pie de página del documento. Se ajusta la línea del pie de página.
\renewcommand\footrule{
\begin{minipage}{1\textwidth}
    \hrule width \hsize
\end{minipage}\par
}

\lfoot{}                                                 % Parte izquierda.
\cfoot{}                                                 % Centro.
\rfoot{Página\ \thepage\ de\ \protect\pageref{LastPage}} % Parte derecha.


% ----
% PORTADA
% ----

% Estilo
\usepackage{title1}

% Título y autores
\newcommand{\doctitle}{Aplicaciones de caracteres}
\newcommand{\docsubtitle}{}
\newcommand{\docdate}{1 \ de \ Enero \ de \ 2015}
\newcommand{\subject}{Representaciones}
\newcommand{\docauthor}{D. Charte, J.C. Entrena, L. Soto, M. Román}
\newcommand{\docaddress}{Universidad de Granada}
\newcommand{\docemail}{}

% Resumen
\newcommand{\docabstract}{El cálculo de orientaciones en el espacio tridimensional es necesario para la generación de gráficos y animaciones por ordenador. Los ángulos de Euler representan el espacio de orientaciones pero no forman un homeomorfismo local, lo que causa errores gráficos (bloqueo del cardán), mientras que los cuaterniones de Hamilton sí proporcionan un recubrimiento de dos hojas del mismo. Con ellos presentaremos un ejemplo de movimiento de objetos en gráficos tridimensionales.}

\begin{document}

\maketitle

% Profundidad del Índice
%\setcounter{tocdepth}{1}
\newpage
\tableofcontents
\newpage

\section{El grupo de rotación}
\subsection{El grupo de rotación SO(3)}

\begin{definition}
  Llamamos $O(n)$ al grupo de las \textbf{matrices ortogonales}
  de dimensiones $n \times n$, aquellas que cumplen que $Q^TQ = QQ^T = I$,
  bajo la composición.
\end{definition}

Nótese que las matrices ortogonales forman un subgrupo del grupo
lineal $GL(n)$ de matrices invertibles; y que, por definición, sólo
pueden tener determinante $1$ y $-1$.

\begin{definition}
  Llamamos $SO(n)$ al \textbf{subgrupo de rotaciones}, definido como
  el subgrupo de $O(n)$ formado por aquellas matrices que tienen
  determinante $1$.
\end{definition}

Vamos a considerar $SO(3)$, las rotaciones sobre el origen de $\mathbb R^3$, pues son laz que nos interesan en este caso.
Vamos a ver un resultado sobre la topología de este grupo.

\begin{proposition}
	$SO(3)$ es homeomorfo a $\mathbb{RP}^3$
\end{proposition}

\begin{proofname}\\
	Consideramos una esfera en $\mathbb R^3$ de radio $\pi$, $\mathbb B = B(0, \pi)$. Asignamos a cada punto $x \in \mathbb B$
	una rotación, con eje la recta que une el origen y $x$, y ángulo de rotación $\alpha = d(x, O)$ la distancia con signo al
	origen. De esta forma, cada	punto representa una única rotación, salvo los puntos antípoda, a los que corresponden las
	rotaciones de ángulos $\pi$ y $-\pi$, que son la misma. Esto nos lleva a identificar los puntos antípoda de $\partial \mathbb B$,
	lo que establece un homeomorfismo entre $SO(3)$ y $\mathbb{RP}^3$. $\qed$
\end{proofname}


\begin{remark}
	De hecho, por ser $\mathbb B$ una variedad diferenciable $\mathbb{C^{\infty}}$, el homeomorfismo es un difeomorfismo.
\end{remark}

De este resultado se deduce que $SO(3)$ es conexo, pero no es simplemente conexo, pues su grupo fundamental no es trivial.



En cada rotación existe una recta invariante, cuyos puntos se mantienen fijos tras aplicarse la rotación.
Llamaremos a esta recta el eje de rotación, y vamos a ver que siempre existe.


\begin{proposition}
	Cada rotación de $SO(3)$ deja fija una recta.
\end{proposition}

\begin{proofname}\\
	Sea $ M \in SO(3)$ una rotación. Queremos ver que la matriz tiene al $1$ como valor propio, que nos dará un subespacio
	de al menos dimensión 1 cuyos puntos se mantienen fijos por $M$.

	Que el $1$ sea valor propio equivale a que $ det(M - I_3) = 0$. Desarrollamos la expresión sabiendo que $M^t = M^{-1}$

	\[ det(M - I_3) = det((M - I_3)^t) ) det(M^t - I_3) = det(M^{-1} - I_3) = \]
	\[= det(M^{-1}(I_3 - M)) = det(M^{-1}) * det(I_3 - M) = det(I_3 - M) = -det(M - I_3) \]

	de donde se deduce directamente que $det(M - I_3) = 0$ y que el $1$ es un autovalor de M. $\qed$
\end{proofname}


\section{Ángulos de Euler}
\subsection{Definición}

Los ángulos de Euler son tres ángulos utilizados para describir la orientación de un objeto respecto a un sistema
coordenadas fijo en el espacio. Análogamente, podemos no considerar como fijo el sistema de coordenadas y ver
los ángulos de Euler como una orientación de dicho sistema.

La forma tradicional de usar rotaciones en el espacio se basa en el uso de las llamadas rotaciones de Euler,
que combinan hasta tres rotaciones sobre los ejes cartesianos, donde la única restricción es que no puede
haber dos rotaciones sobre el mismo eje contiguas, pues derivarían en una.

Las tres rotaciones sobre los ejes cartesianos se pueden combinar de 12 formas distintas, consistentes en
las 6 ordenaciones posibles usando los tres índices, además de aquellas seis en las que aparece el mismo
eje al principio y al final, y uno de los dos restantes en la posición central.


\subsection{Descomposición}
Cada rotación se descompone en sus tres ángulos de Euler de forma única. Vemos las matrices de rotación
respecto a los ejes cartesianos, de forma que la primera es la rotación de ángulo $\psi$ sobre el
eje $z$, la segunda rota $\phi$ grados sobre el eje $y$, y la tercera la que rota $\theta$ grados con respecto
al eje $x$. Las tres rotaciones están consideradas en sentido antihorario.\footnote{Para cambiar el sentido no hay más que cambiarle el signo a los senos}

\[\begin{pmatrix}
    \cos \psi & -\sin \psi & 0 \\
    \sin \psi & \cos \psi & 0 \\
    0 & 0 & 1
  \end{pmatrix}\begin{pmatrix}
      \cos \phi & 0 & \sin \phi \\
      0 & 1 & 0 \\
      -\sin \phi & 0 & \cos \phi
    \end{pmatrix}\begin{pmatrix}
    1 & 0 & 0 \\
    0 & \cos \theta & -\sin \theta \\
    0 & \sin \theta & \cos \theta
  \end{pmatrix}
\]

Podemos ver el espacio de los ángulos de Euler como el 3-toro $\mathbb T^3$, sin más que identificar cada variable de giro
en una dimensión del toro.

% https://es.wikipedia.org/wiki/Teorema_de_rotaci%C3%B3n_de_Euler

\subsection{Bloqueo del cardán}

El principal problema del uso de los ángulos de Euler es el llamado \textit{bloqueo del cardán}. Este fenómeno
consiste en la pérdida de un grado de libertad a la hora de rotar, debida a la alineación de dos de los ejes
de rotación. Esto ocurre cuando se dan ciertas combinaciones en los ángulos de rotación, provocando dicho alineamiento.

Formalmente, el bloqueo del cardán ocurre debido a que el espacio de ángulos de Euler, representados con $\mathbb T^3$,
no puede ser recubridor del espacio de rotaciones, que se identifica con $\mathbb{RP}^3$. Esto puede verse
fácilmente tomando los grupos fundamentales de ambos espacios. Mientras que el grupo fundamental del 3-toro es
$\pi(\mathbb T^3, x) \simeq \mathbb Z^3$, el grupo fundamental del 3-espacio proyectivo es $\pi(\mathbb{RP}^3, x)
\simeq \mathbb Z_2$. Como el grupo fundamental de un recubridor debe ser subgrupo del grupo fundamental del espacio
reducido, deducimos que no puede haber un recubrimiento. De hecho, como $Z_2$ no tiene subgrupos propios, los posibles
espacios recubridores deben tener grupo fundamental $Z_2$ o ser simplemente conexos.

\section{Cuaternios}
\subsection{Versores}
Sabemos que los cuaternios pueden escribirse como
$\mathbb{H} = \mathbb{R} \oplus V$, donde $V$ es el espacio vectorial
real tridimensional de base $i,j,k$, siendo equivalente a la
definición

\[
  V = \left\{ v \in \mathbb{H} \mid v^2 < 0 \right\}
\]

Los cuaternios unitarios, en particular, pueden escribirse como
$\cos \theta + u \sin \theta$, donde $u$ es un vector unitario de
$\mathbb{R}^3$. A un cuaternio así escrito se le llama
\textbf{versor}.

\begin{proof}
  Si tenemos $q = a + bv$ con $v$ unitario, sabemos que $v^2 = - v(-v) = - vv^\ast = 1$.
  Entonces, si $q$ es unitario,

  \[
    1 = qq^\ast = (a+bv)(a-bv) = a^2 + b^2.
  \]

  Con lo que existirá algún $\theta$ para el que $a = \cos \theta$ y $b = \sin \theta$.
\end{proof}

\subsection{Conexión con SU(2)}
\cite{gelfand63}
% https://en.wikipedia.org/wiki/Rotation_group_SO(3)#Connection_between_SO.283.29_and_SU.282.29

\begin{definition}
  Llamamos $\mathrm{SU}(n)$, al espacio de las matrices complejas unitarias de determinante $1$.
  Es decir,

  \[SU(n) = \left\{ M \in U_n(\mathbb{C}) \mid \mathrm{det}(M) = 1 \right\}.\]
\end{definition}

En particular nos interesamos por $SU(2)$ porque podemos verlo como un embebimiento de la
esfera tridimensional en $\mathbb{R}^4$.

\begin{theorem}
  Cada matriz en $SU(2)$ puede escribirse como

  \[\begin{pmatrix}
      a+bi & c+di \\
      -c+di & a-bi
    \end{pmatrix}\]

  donde $a,b,c,d \in \mathbb{R}$ y $a^2+b^2+c^2+d^2 = 1$.
\end{theorem}
\begin{proof}
  Si tomamos $\alpha,\beta,\gamma,\delta \in \mathbb{C}$ formando una matriz unitaria de
  determinante $1$ como

    \[\begin{pmatrix}
      \alpha & \beta \\
      \gamma & \delta
    \end{pmatrix},\]

  tenemos las relaciones siguientes, obtenidas del hecho de que debe ser ortogonal

  \begin{itemize}
    \item $|\alpha|+|\beta| = 1$
    \item $\alpha\delta-\beta\gamma = 1$
    \item $\alpha\overline{\gamma} + \beta\overline{\delta} = 0$
  \end{itemize}

  y que se resuelven con $\alpha = \overline{\delta}$ y
  $\beta = -\overline{\gamma}$; mientras que la primera condición
  nos da la condición $a^2+b^2+c^2+d^2 = 1$.
\end{proof}


\subsection{Cuaternios como esfera de dimensión 4}


\subsection{Recubrimiento del grupo de rotaciones}

A diferencia del caso de los ángulos de Euler, los cuaternios unitales sí son un recubrimiento del espacio de rotaciones
$SO(3)$. Esto se deduce directamente del hecho de que $S^3$ es un recubridor de dos hojas de $\mathbb{RP}^3$ (de hecho,
es su recubridor universal).

Al ser recubridor de dos hojas, tenemos que los cuaternios que se identifican por la relación de equivalencia de $\mathbb{RP}^3$
representan la misma rotación, pues van al mismo elemento por la aplicación recubridora. En este caso, son los cuaternios opuestos. 

\section{Aplicación en gráficos}

\subsection{Exponenciación de cuaternios}
\begin{definition}
  Se define la función \textbf{exponencial en cuaternios}, $\exp \colon \mathbb{H} \to \mathbb{H}$, desde
  la serie de potencias de la función exponencial usual, es decir,

  \[
    \exp(q) =  1 + q + \frac{q^2}{2!} + \frac{q^3}{3!} + \dots + \frac{q^n}{n!} + \dots .
  \]
\end{definition}

Si escribimos los cuaternios como versores, $q = \cos \theta + v \sin \theta$, tendremos que
como $v^2 = -1$, se cumple la fórmula de Euler para cualquier $\theta \in \mathbb{R}$ como
$\exp(\theta v) = \cos \theta + v \sin \theta = q$,
y por tanto podemos calcular la exponente de un cuaternio como

\[
  q^t = \exp(t \theta v) = \cos (t \theta) + v \sin (t \theta).
\]

\subsection{Spherical Linear Interpolation (SLERP)}
El método \textbf{SLERP} (Spherical Lineal Interpolation) permite interpolar
un punto entre dos orientaciones de manera continua. Dadas dos orientaciones
$q_1,q_2$ representadas como cuaterniones, un punto $p$ y un parámetro de
interpolación $t$, buscamos un camino continuo que interpole $p$ desde $q_1$,
cuando $t=0$, hasta $q_2$, cuando $t=1$.

Para calcular la rotación interpolada, usamos la fórmula

\[q' = q_1(q_1^{-1}q_2)^t\]

Cuando interpolamos usando SLERP, la interpolación de cuaternios induce a
su vez una interpolación en las rotaciones tridimensionales, que nos dará
una rotación con velocidad angular uniforme y alrededor de un eje fijo.
% Por qué? https://en.wikipedia.org/wiki/Slerp#Quaternion_Slerp

Sin embargo, como el recubrimiento es doble, el camino de rotaciones puede
ser doble y ser o bien el camino más corto, o bien el camino más largo.

% http://number-none.com/product/Understanding%20Slerp,%20Then%20Not%20Using%20It/

\subsection{Spherical and Quadrangle (SQUAD)}


\section{Referencias}
% https://en.wikipedia.org/wiki/Euler_angles
% https://en.wikipedia.org/wiki/Gimbal_lock
% https://en.wikipedia.org/wiki/Rotation_group_SO(3)
% https://en.wikipedia.org/wiki/Plate_trick
% https://en.wikipedia.org/wiki/Charts_on_SO(3)
% https://www.3dgep.com/understanding-quaternions/

\begin{thebibliography}{9}

\bibitem{gelfand63}
  Gelfand, I.M.; Minlos, R.A.; Shapiro, Z.Ya. (1963),
  Representations of the Rotation and Lorentz Groups and their Applications,
  New York: Pergamon Press.

\end{thebibliography}

\end{document}
